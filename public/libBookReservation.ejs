<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="refresh" content="5"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>book reservation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: fill;
        }

        body {
            background-image: linear-gradient(rgba(167, 157, 143, 0), rgba(167, 157, 143, 0)), url("libimg2.jpg");
        }

        .container {
            width: 100%;
            /* padding: 5%; */
            min-height: 100vh;

            background-position: center;
            background-size: cover, ;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-bottom: 10%;

        }


        .search-bar {
            width: 100%;
            max-width: 700px;
            background: rgba(233, 225, 225, 0.4);
            display: flex;
            align-items: center;
            border-radius: 60px;
            padding: 10px 20px;
            backdrop-filter: blur(4px) saturate(180%);
            /* margin: auto; */
            margin-top: 10%;

        }

        .search-bar input {
            background: transparent;

            flex: 1;
            border: none;
            outline: none;
            padding: 14px 10px;
            font-size: 20px;
            color: white;
        }

        ::placeholder {
            color: black;
        }

        .search-bar button img {
            width: 40px;
            border-radius: 50%;
            color: wheat;
            /* background wheat; */
            cursor: pointer;
            border: 0;
            position: relative;
            top: 2px;

        }

        .search-bar button {
            border: 0;
            border-radius: 50%;


        }

        .search-header {
            font-size: 50px;
            position: relative;
            /* top: -180px; */
            /* text-align center; */

        }

        .book-container {
            padding-top: 10%;
            display: grid;
            grid-template-columns: repeat(4, auto);
            grid-gap: 80px;
        }

        /* 
        .book-container::after {
            content: " ";
            width: 250px;
        } */

        .book {
            /* border: 2px solid white; */
            padding: 3%;
            margin-bottom: 30px;
        }

        .book h3 {
            /* width: 50%; */
            color: wheat;
            margin-bottom: 30px;
            display: block;
            flex-direction: column;
        }

        .book>p {
            color: white;
        }

        .book:hover {
            background-color: transparent;
            ;
        }

        .btn1 {
            border: 1px solid white;
            padding: 15px;
            display: inline-block;
            width: 50%;
            margin-right: 20px;
            background-color: rgb(39, 167, 7);
            font-size: 15px;
            color: rgb(10, 10, 10);
            cursor: pointer;
        }

        .btn1:hover {
            background-color: rgb(142, 204, 113);
            cursor: pointer;

        }

        .btn2 {
            border: 1px solid white;
            padding: 12px;
            display: inline-block;
            width: max-content;
            cursor: pointer;

        }

        .bookmodal {
            position: absolute;
            top: 130%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            min-height: 60%;
            background-color: white;
            padding: 6rem;
            border-radius: 5px;
            box-shadow: 0 3rem 5rem rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .hidden {
            display: none;
        }

        .close-modal {
            position: absolute;
            top: 1.2rem;
            right: 2rem;
            font-size: 5rem;
            color: #333;
            cursor: pointer;
            border: none;
            background: none;
        }

        .msg {
            border: 1px solid black;
            border-radius: 20px;
            padding: 20px;
            background-color: rgb(142, 204, 113);
            position: fixed;
            right: 0;
            font-size: 20px;
            margin-right: 5%;
            width: 30%;

        }

        @media (max-width:900px) {
            .search-bar {
                width: 80%;
                max-width: 700px;
                background: rgba(233, 225, 225, 0.4);
                display: flex;
                align-items: center;
                border-radius: 60px;
                padding: 10px 20px;
                backdrop-filter: blur(4px) saturate(180%);
                /* margin: auto; */
                margin-top: 10%;

            }

            .search-header {
                display: none;
            }


            .book-container {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        /* .flex-start {

            align-items: baseline;
            ma


        } */
    </style>
</head>

<body>

    <div class="container ">
        <div class="msg hidden">you reserved your book successfully</div>
        <h1 class="search-header " style="color:black;">Search Your Books <br> Down Here..</h1>
        <div class="search-bar">

            <input type="search" id="search" placeholder="Search a book" class="searchInput">
            <button class="searchbtn"><img src="searchicon1.png" alt=""></button>

        </div>
        <div class="book-container hidden"></div>


        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

        <script>

            //Serach features
            const searchbtn = document.querySelector(".searchbtn");
            const container = document.querySelector(".container");
            const searchHeader = document.querySelector(".search-header");
            const booksContainer = document.querySelector(".book-container");
            const searchInput = document.querySelector(".searchInput");
            const bookName = document.querySelectorAll(".book-name");
            const msg = document.querySelector(".msg")
            console.log(bookName);
            const book = document.querySelectorAll(".book")
            console.log(book);
            searchInput.addEventListener("input", (e) => {
                const value = e.target.value;

                if (value) {
                    searchHeader.classList.add("hidden");

                    booksContainer.classList.remove("hidden");
                    msg.classList.add("hidden")
                } else {
                    searchHeader.classList.remove("hidden");

                    booksContainer.classList.add("hidden");
                    msg.classList.add("hidden")
                }
            })



            // searchInput.addEventListener("keydown", (e) => {
            //     if (e.key === "Enter") {
            //         searchbtn.click();
            //     }
            // })



            const books = [
                {
                    book_id: 1,
                    book_title: 'The Pragmatic programmer',
                    author: 'Andrew Hunt, David Thomas',
                    latest_edition: 'Second (20th Anniversary Edition)',
                    publishers: 'Addison-Wesley Professional',
                    book_img: 'b1.jpg',
                    book_discription:
                        ' Since its creation in 1999 by its authors to aid its clientele to develop better software,The Pragmatic Programmer has succeeded in becoming one of the highly-revered programming books. This book is for every coder looking to transcend to be a skilled software developer and a full-fledged programmer.',
                },
                {
                    book_id: 2,
                    book_title: 'Head First Design Patterns',
                    author: 'Eric Freeman',
                    latest_edition: 'First',
                    publishers: "O'Reilly Media",
                    book_img: 'b2.jpg',
                    book_discription:
                        'The Head First book series is known for its innovative way of breaking down complex topics intosimpler, easy-to-understand units. The Head First Design Patterns: A Brain-Friendly Guide is compiled based on this tried-and-tested formula.There is a galore of illustrative and brain-stimulating examples in the Head First Design Patternsbook that will make learning both efficient and fun simultaneously.',
                },
                {
                    book_id: 3,
                    book_title: 'Artificial Intelligence',
                    author: 'Jhon paul',
                    latest_edition: '',
                    publishers: 'pearson',
                    book_img: 'b3.jpg',
                    book_discription: '',
                },
                {
                    book_id: 4,
                    book_title: 'Eloquent JavaScript',
                    author: 'marjin',
                    latest_edition: '',
                    publishers: 'pearson',
                    book_img: 'b4.jpg',
                    book_discription: '',
                },

                {
                    book_id: 5,
                    book_title: 'C++ Primer',
                    author: 'stanly,josee,barbara',
                    latest_edition: '',
                    publishers: 'pearson',
                    book_img: 'b5.jpg',
                    book_discription: '',
                },
                {
                    book_id: 6,
                    book_title: 'C Programming',
                    author: 'greg perry',
                    publishers: 'perason',
                    latest_edition: '',
                    book_img: 'b6.jpg',
                    book_discription: '',
                },
                {
                    book_id: 7,
                    book_title: 'Head First Java',
                    author: 'Eric',
                    publishers: "O'relly",
                    latest_edition: 'greg perry',
                    book_img: 'b7.jpg',
                    book_discription: '',
                },
            ];

            const bookContainer = document.querySelector('.book-container');
            const reservebtns = document.querySelectorAll('.btn1');
            let count = 0;
            let disabled = false;
            books.forEach(book => {
                const html = `  <div class="book">
  <img class="book-cover" src="${book.book_img}" alt="Book 1 Cover">
  <h3 class="book-name">${book.book_title}</h3>
  <button class="btn1">Reserve</button>
  <button class="btn2">Learn More</button>

  <div class="bookmodal hidden">
      <button class="close-modal">&times;</button>
      <img class="book-cover" src="${book.book_img}" alt="Book 1 Cover">
      <h3>Author</h3> - ${book.author}
      <h3>Latest Edition</h3> - ${book.latest_edition}
      <h3>Publisher</h3> -${book.publishers}

      <h3>About Book:</h3>
      <p>${book.book_discription}</p>

  </div>
</div>`;

                bookContainer.insertAdjacentHTML('afterbegin', html);
                if (!disabled) {
                    const reserveBtn = bookContainer.querySelector('.btn1');
                    reserveBtn.addEventListener("click", () => {
                        reserveBook(book);
                        reserveBtn.textContent = "Booked"
                        reserveBtn.style.backgroundColor = "grey";



                        setTimeout(() => {
                            msg.classList.remove("hidden")
                            reserveBtn.style.display = "none"
                        }, 1000)
                        setTimeout(() => {
                            msg.classList.add("hidden")
                            // reserveBtn.style.display = "none"
                        }, 5000)

                        count++
                        msg.textContent = `you reserved ${count} books for now. Feel free to book again!`
                        // msg.textContent = "you reserved 2 books for now.it was limited for day."


                    });

                }
            });

            async function reserveBook(book) {

                await axios.post("/bookReservation", book).then(response => {
                    console.log(response)
                }
                )


            }



            const btn2 = document.querySelectorAll(".btn2");
            const bookmodal = document.querySelectorAll(".bookmodal");
            const closeModal = document.querySelectorAll(".close-modal")
            console.log(btn2.length);
            console.log(bookmodal.length);
            for (let i = 0; i < btn2.length; i++) {
                btn2[i].addEventListener("click", () => {
                    bookmodal[i].classList.remove("hidden");



                    closeModal[i].addEventListener("click", () => {
                        bookmodal[i].classList.add("hidden");
                    })


                })
                // window.addEventListener("click", (e) => {
                //     if (e.target === bookmodal) {
                //         bookmodal[i].classList.add("hidden");
                //     })
            }
            searchInput.addEventListener("input", (e) => {
                const value = e.target.value;
                console.log(value);
                for (let i = 0; bookName.length; i++) {
                    let bookNameValue = book[i].getElementsByClassName("book-name")[0];
                    console.log("bookname", bookNameValue);

                    if (bookNameValue) {
                        let textvalue = bookNameValue.textContent || bookNameValue.innerHTML;
                        console.log(textvalue);

                        if (textvalue.toUpperCase().indexOf(value.toUpperCase()) > -1) {
                            book[i].style.display = "";
                        }
                        else {
                            book[i].style.display = "none";
                        }
                    }
                }
            })



        </script>
</body>

</html>